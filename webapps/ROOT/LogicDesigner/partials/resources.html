<div class="row SingleRowView">
	<table style="height: 100%; width: 100%;">
		<tr style="height: 100%;">

			<td class="ResizableTd" id="subresourcesListTd" style="min-width: 50px; width: {{data.subresourcesListWidth}}px;">
				<div class="ScrollableList" style="width: 100%;">
					<div class="ScrollableListControlHeader btn-horizontal-1">
						<button type="button" class="btn btn-list-control btn-xs" ng-click="createResource()">
							<span class="glyphicon glyphicon-plus-sign ScrollableListControl"></span>
							New Resource
						</button>
					</div>
					<div class="ScrollableListControlHeader resource-tree-controls btn-horizontal-2">
						<button type="button" class="btn btn-list-control btn-xs" ng-click="createSubResource()">
							<span class="glyphicon glyphicon-plus-sign ScrollableListControl"></span>
							New Level
						</button><!-- need this white space 
						--><button type="button" class="btn btn-list-control btn-xs" ng-click="deleteSubResource()" ng-disabled="!selectedSubResource">
							<span class="glyphicon glyphicon-remove-sign ScrollableListControl"></span>
							Delete
						</button>
					</div>
					<!-- add "-" to uncomment expand/collapse buttons:->
						<div class="ScrollableListControlHeader btn-horizontal-2"><button type="button" class="btn btn-list-control btn-xs" onclick="var id = $('#treeBox').jstree('get_selected').attr('id'); $('#treeBox').jstree('open_all', '#' + id);">
							<span class="glyphicon glyphicon-collapse-down ScrollableListControl"></span>
							Expand Node
						</button><button type="button" class="btn btn-list-control btn-xs" onclick="var id = $('#treeBox').jstree('get_selected').attr('id'); $('#treeBox').jstree('close_all', '#' + id);">
							<span class="glyphicon glyphicon-collapse-up ScrollableListControl"></span>
							Collapse Node
						</button></div>
					<!-- -->
					<div class="ResizableColumn" style="height: 75%; min-height: 350px;" id="resourceTreeDiv">
						<div id="treeBox" class="ResourceTree" style="height: 100%;"></div>
					</div>
					<div class="api-version-selector" ng-if="apiVersions.length > 1">
						<div class="input-group">
							<div class="input-group-addon">API Version: </div>
							<select class="form-control" ng-model="active.selectedApiVersion" ng-options="version.name for version in $parent.apiVersions" ng-change="updateApiSelection();">
							</select>
						</div>
					</div>
				</div>
			</td>

			<td class="ResizableBodyTd">
				<tabset>
					<tab heading="Resource" active="data.activeTabs[0]" id="resourceDiv">
						<form ng-hide="!selectedSubResource" role="form" style="padding: 5px;">
							<div class="form-group">
								<label for="ResourceTypeSelect">Resource type:</label>&nbsp;<i class="glyphicon glyphicon-question-sign ContextHelpButton" ng-click="helpDialog('resource', 'resourceType')"></i>
								<select size="1" required ng-model="selectedSubResource.resource_type_ident"
										class="form-control" type="number" ng-change="resourceTypeSelected()"
										id="ResourceTypeSelect">
									<option value="1">Normal</option>
									<option value="2">Free SQL</option>
									<option value="3">JavaScript</option>
									<option value="5">MongoDB</option>
								</select>
							</div>
							<div class="form-group" ng-hide="selectedSubResource.resource_type_ident != 1">
								<label for="TablesSelect">Table:</label>
<!--								<select size="1" required ng-model="selectedSubResource.entity_name" ng-change="tableSelected()"
										ng-options="table.name as table.name for table in allTablesList" id="TablesSelect"
										class="form-control"></select>
 -->
<ui-select ng-click="checkAttributeState();" id="zzz" ng-model="data.selectedSubResourceTable" theme="selectize" ng-disabled="disabled"
										style="width: 250px;" ng-change="tableSelected()">
									<ui-select-match placeholder="Select or search a table in the list...">{{$select.selected.name}}</ui-select-match>
									<ui-select-choices repeat="table in allTablesList | filter: $select.search">
										<span ng-bind-html="table.name | highlight: $select.search"></span><br/>
										<small ng-bind-html="table.remarks | shorten: 38 | highlight: $select.search"></small>
									</ui-select-choices>
								</ui-select>
							</div>
							<div class="form-group" ng-show="selectedSubResource.resource_type_ident == 2">
								<label for="DbSelect">Database prefix:</label>
								<select size="1" required ng-model="selectedSubResource.prefix"
										ng-options="prefix for prefix in allDbPrefixes" id="DbSelect"
										class="form-control"></select>
							</div>
							<div class="form-group">
								<label for="resourceName">Resource name:</label>
								<input type="text" class="form-control" ng-model="selectedSubResource.name" select-on-click id="resourceName" />
							</div>
							<div class="checkbox">
								<label>
									<input type="checkbox" ng-model="selectedSubResource.is_collection" id="resourceIsCollection"
										ng-true-value="Y" ng-false-value="N" ng-change="isCollectionClicked()"
										/>Is a collection
								</label>
								<i class="glyphicon glyphicon-question-sign ContextHelpButton" ng-click="helpDialog('resource', 'IsACollection')"></i>
							</div>
							<div class="form-group" ng-show="selectedSubResource.resource_type_ident == 5">
								<label for="mongoServer">Mongo server:</label>
								<input type="text" class="form-control" ng-model="selectedSubResource.prop1" select-on-click id="mongoServer" />
							</div>
							<div class="form-group" ng-show="selectedSubResource.resource_type_ident == 5">
								<label for="mongoDbName">Mongo database name:</label>
								<input type="text" class="form-control" ng-model="selectedSubResource.prop2" select-on-click id="mongoDbName" />
							</div>
							<div class="form-group" ng-show="selectedSubResource.resource_type_ident == 5">
								<label for="mongoUser">Mongo user name:</label>
								<input type="text" class="form-control" ng-model="selectedSubResource.prop3" select-on-click id="mongoUser" />
							</div>
							<div class="form-group" ng-show="selectedSubResource.resource_type_ident == 5">
								<label for="mongoPassword">Mongo password:</label>
								<input type="password" class="form-control" ng-model="selectedSubResource.prop4" select-on-click id="mongoPassword" />
							</div>
							<div class="form-group" ng-show="selectedSubResource.resource_type_ident == 5">
								<label for="mongoCollName">Mongo collection name:</label>
								<input type="text" class="form-control" ng-model="selectedSubResource.table_name" select-on-click id="mongoCollName" />
							</div>
							<div class="form-group" ng-show="selectedSubResource.container_ident">
								<label for="resourceJoin">Join: <i class="glyphicon glyphicon-question-sign ContextHelpButton"
									ng-click="helpDialog('resource', 'Join')"></i></label>
								<textarea cols="60" rows="2" class="form-control" ng-model="selectedSubResource.join_condition" id="resourceJoin"></textarea>
							</div>
							<div class="form-group">
								<label for="resourceDescription">Description:</label>
								<textarea cols="60" rows="3" class="form-control" ng-model="selectedSubResource.description" id="resourceDescription"></textarea>
							</div>
							<button class="btn btn-primary" ng-click="saveResource()" style="margin: 5px;">Save</button>
							<button class="btn {{savedResource && 'btn-warning'}}" ng-disabled="!selectedSubResource" ng-click="goToRestlab()" style="margin: 5px;"><a style="color:gray;" ng-click="goToRestlab();"" title="Go To REST Lab" class="fa fa-flask"></a> Test</button>
							<button class="btn" ng-disabled = "!selectedResource" ng-click="exportResource()" style="margin: 5px;">Export</button>
							<button class="btn" ng-click="importResource()" style="margin: 5px;">Import</button>
						</form>
					</tab>

					<tab heading="Details" active="data.activeTabs[1]" ng-show="!params.evalMode">
						<form role="form" ng-show="selectedSubResource.resource_type_ident == 1 || selectedSubResource.resource_type_ident == 5">
							<div class="form-group">
								<label for="resourceFilter" class="control-label">Filter: <i class="glyphicon glyphicon-question-sign ContextHelpButton" ng-click="helpDialog('resource', 'Filter')"></i></label>
								<textarea cols="60" rows="3" ng-model="selectedSubResource.filter" id="resourceFilter"
									class="form-control"></textarea>
							</div>
							<div class="form-group" ng-show="selectedSubResourceParent.resource_type_ident == 5">
								<label for="attachPath">Attach path: <i class="glyphicon glyphicon-question-sign ContextHelpButton" ng-click="helpDialog('resource', 'AttachPath')"></i></label>
								<input type="text" class="form-control" ng-model="selectedSubResource.attach_path"
									select-on-click id="attachPath" />
							</div>
							<div class="form-group" ng-show="selectedSubResource.resource_type_ident == 5">
								<label for="mongoKeys">Mongo keys: <i class="glyphicon glyphicon-question-sign ContextHelpButton" ng-click="helpDialog('resource', 'MongoKeys')"></i></label>
								<input type="text" class="form-control" ng-model="selectedSubResource.prop5"
									select-on-click id="mongoKeys" />
							</div>
							<div class="form-group">
								<label for="resourceOrder" class="control-label">Order:</label>
								<textarea cols="60" rows="3" ng-model="selectedSubResource.sorting" id="resourceOrder"
									class="form-control"></textarea>
							</div>
							<button class="btn btn-primary" ng-click="saveResource()">Save</button>
						</form>
						<div ng-show="selectedSubResource.resource_type_ident == 2 || selectedSubResource.resource_type_ident == 3">
							Code:
							<pre id="sqlTextBox" style="height: 20em; width: 90%;"></pre>
							<button class="btn btn-primary" ng-click="saveResource()">Save</button>
						</div>
					</tab>

					<tab heading="Attributes" active="data.activeTabs[2]">
						<div class="row" style="padding-top: 7px;" ng-show="selectedSubResource.resource_type_ident == 1">
							<div class="col-md-4" style="overflow: auto;">
								<div class="panel panel-default">
									<div class="panel-heading">
										<span class="panel-title">Columns</span>
									</div>
									<div class="panel-body">
										<button class="btn btn-sm" ng-click="selectAllColumns()" style="margin-bottom: 5px;">
											Select all
										</button>
										<table>
											<tr ng-repeat="column in tableColumns" ng-class="getColumnClass(column)">
												<td>
													<input id="{{column.name}}" type="checkbox" ng-model="column.checked" ng-change="columnSelectChanged(column)" />
												</td>
												<td>
													<label for="{{column.name}}" ng-click="columnClicked(column)">{{column.name}}</label>
												</td>
												<td>
													<span class="glyphicon glyphicon-star" ng-show="getIsDefinedKeyPart(column)"></span>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
							<div class="col-md-8">
								<div class="panel panel-default">
									<div class="panel-heading">
										<span class="panel-title">Column name: {{selectedColumn.name}}</span>
									</div>
									<div class="panel-body">
										<div style="position:absolute;top:0;left:0;width:100%;height:100%; background-color:#FFFFFF; opacity: 0.5;"
											ng-hide="showResAttribTable.value"></div>
										<form role="form">
											<div class="form-group">
												<label for="resourceAttributeName">Attribute name:
													<i class="glyphicon glyphicon-question-sign ContextHelpButton" ng-click="helpDialog('resource', 'AttributeName')"></i>
												</label>
												<input type="text" class="form-control" ng-model="resourceAttribute.name" id="resourceAttributeName" />
											</div>
<!--											<div class="form-group">
												<label for="resourceAttributeFormat">Format:</label>
												<input type="text" class="form-control" ng-model="resourceAttribute.format" id="resourceAttributeFormat" />
											</div>
 -->
											<div class="form-group" ng-show="!params.evalMode">
											<label for="resourceIsDefinedKeyPart">Part of Defined Key:</label>
											<input type="checkbox" ng-model="resourceAttribute.is_defined_key_part" id="resourceIsDefinedKeyPart" />
											</div>
											<div class="form-group">
												<label for="resourceAttributeDescription">Description:</label>
												<textarea rows="4" class="form-control" ng-model="resourceAttribute.description"
													id="resourceAttributeDescription"></textarea>
											</div>
											<button ng-click="saveResource()" class="btn btn-primary">Save</button>
											<button class="btn {{savedResource && 'btn-warning'}}" ng-disabled="!selectedResource" ng-click="goToRestlab()" style="margin: 5px;"><a style="color:gray;" ng-click="goToRestlab();"" title="Go To REST Lab" class="fa fa-flask"></a> Test</button>
										</form>
									</div>
								</div>
							</div>
						</div>
						<div class="row" ng-show="selectedSubResource.resource_type_ident != 1">
							This is not a Normal resource, it does not have attributes defined here.
							<br/>Free SQL resources define attributes by the columns they select in the SQL statement.
							<br/>JavaScript resources define the entire structure of the JSON returned.
						</div>
					</tab>

					<tab heading="Row Event" active="data.activeTabs[3]" ng-show="!params.evalMode">
						<pre id="filterJSCode" style="height: 30em;"></pre>
						<button ng-click="saveResource()" style="margin: 5px;" class="pull-left btn btn-primary">Save</button>
						<div class="pull-right" style="font-size: 8pt; color: #777777; padding: 4px; margin: 3px;">
							Available variables:<br/>
							- row is the projected and renamed row. You can change it (carefully).<br/>
							&nbsp;&nbsp;&nbsp; and can be used to add properties to the output JSON<br/>
							- tableRow is the row as read from the database (after security applied).<br/>
							- parentRow is the parent row, if available.<br/>
							- resource is the resource definition.<br/>
							- req is the current request<br/>
							- restrequest is the raw Java object for the request<br/>
							- log is a logger, e.g. log.debug('Hello')<br/>
							You can do <code>row = null;</code> if the row should be skipped.
						</div>
					</tab>
						<!-- -><tab active="data.activeTabs[4]">
							<tab-heading>Test &nbsp;&nbsp; <a ng-click="goToRestlab();" title="Go To REST Lab" class="fa fa-flask"></a></tab-heading>
							<div class="col-md-12">
								<form class="form-inline">
									<input type="text" size="30" placeholder="parameters" ng-model="$parent.$parent.queryParams" />
									&nbsp;&nbsp;
									<span class="help-inline">API key:</span>
									<select size="1" ng-model="params.selectedApiKey"
											ng-options="apiKey.name for apiKey in apiKeys"></select>
									&nbsp;
									<button class="btn btn-primary" ng-click="fetchJson()" ng-disabled="!selectedResource">Fetch</button>
								</form>
							</div>
							<pre id="jsonTextBox" style="height: 27em;"></pre>
						</tab>
						<!-- -->
				</tabset>
			</td>
		</tr>
	</table>
</div>
<iframe id="downloadIframe" style="display: none;"></iframe>
